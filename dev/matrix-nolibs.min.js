/*!
 * Matrix - A Mobile WebApp Framework
 * http://github.com/mxjs/matrix
 * 
 * Author: max<zhangdaiping@gmail.com>
 * 
 * This version of Matrix is licensed under the MIT License.
 * http://github.com/mxjs/matrix/blob/master/MIT-LICENSE.md
 */
(function(e,t){typeof define=="function"&&define.amd?define(["jquery","jquerymobile","arttemplate"],function(n,r,i){return t(e,n,r,i),e.MX}):t(e,e.jQuery,e.jQuery.mobile,e.template)})(window,function(e,t,n,r){e.MX={},function(t,n,r){var i=Array.prototype.slice,s=Object.prototype.toString,o=e.navigator.userAgent,u=o.match(/(Android)[\/\s+]([\d.]+)/),a=o.match(/(iPad).*OS\s([\d_]+)/),f=!a&&o.match(/(iPhone\sOS)\s([\d_]+)/),l=o.match(/(webOS|hpwOS)[\s\/]([\d.]+)/),c=l&&o.match(/TouchPad/),h=o.match(/Kindle\/([\d.]+)/),p=o.match(/(BlackBerry).*Version\/([\d.]+)/),d;t.version="0.0.8",t.namespace=function(){var t=arguments.length,n=0,r,i,s,o,u,a;for(;n<t;++n){s=arguments[n],o=arguments[n].split("."),a=e[o[0]],a===undefined&&(a=e[o[0]]={}),u=o.slice(1),r=u.length;for(i=0;i<r;++i)a=a[u[i]]=a[u[i]]||{}}return a},t.ns=t.namespace,t.ns("MX.lib","MX.klass","MX.lib","MX.util","MX.app"),n.extend(t.lib,{jQuery:n,artTemplate:r}),r&&(r.openTag="<#",r.closeTag="#>"),n.extend(t,{emptyFn:n.noop,isDefined:function(e){return typeof e!="undefined"},isPrimitive:function(e){var t=typeof e;return t==="string"||t==="number"||t==="boolean"},isEmpty:function(e,n){return e===null||e===undefined||(n?!1:e==="")||t.isArray(e)&&e.length===0},isArray:n.isArray,isDate:function(e){return n.type(e)==="date"},isObject:n.isPlainObject,isFunction:n.isFunction,isNumber:function(e){return n.type(e)==="number"},isNumeric:n.isNumeric,isString:function(e){return n.type(e)==="string"},isBoolean:function(e){return n.type(e)==="boolean"},isElement:function(e){return e?e.nodeType===1:!1},isTextNode:function(e){return e?e.nodeName==="#text":!1}}),d={},u&&(d.android=!0,d.version=u[2]),f&&(d.ios=d.iphone=!0,d.version=f[2].replace(/_/g,".")),a&&(d.ios=d.ipad=!0,d.version=a[2].replace(/_/g,".")),l&&(d.webos=!0,d.version=l[2]),c&&(d.touchpad=!0),p&&(d.blackberry=!0,d.version=p[2]),h&&(d.kindle=!0,d.version=h[1]),n.extend(t,{os:d,applyIf:function(e,t){var n;if(e)for(n in t)e[n]===undefined&&(e[n]=t[n]);return e},toArray:function(e){var n,r,o;if(!t.isDefined(e))n=[];else if(t.isArray(e))n=i.call(e,0);else if(s.call(e)=="[object Arguments]")n=i.call(e,0);else{n=[];for(r=0,o=arguments.length;r<o;r++)n.push(arguments[r])}return n},each:function(e,r,i){if(!e||!r)return;t.isDefined(i)?n.each(e,n.proxy(r,i)):n.each(e,r)},defer:function(t,n,r,i){return r=r||e,n>0?setTimeout(function(){t.apply(r,i)},n):(t.apply(r,i),0)}}),n.extend(t,{kindle:function(){var n=t.toArray.apply(t,arguments),r=n.length,i=n.slice(0,r-1),s=n[r-1];t.each(i,function(e,n){i[e]=t.klass.KlassManager.get(n)}),s.apply(e,[t].concat(i))},ready:function(){var r=t.toArray.apply(t,arguments);n(document).ready(function(){t.kindle.apply(e,r)})}})}(e.MX,e.jQuery,e.template),MX.kindle(function(e){e.klass.KlassManager=function(){var t={},n={register:function(e,n){t[e]=n},get:function(n){return e.isString(n)?t[n]:n},create:function(e,t){var r=n.get(e);return new r(t)}};return n}(),e.reg=e.klass.KlassManager.register,e.getClass=e.klass.KlassManager.get,e.create=e.klass.KlassManager.create,e.reg("$",e.lib.jQuery),e.reg("jquery",e.lib.jQuery),e.lib.artTemplate&&e.reg("arttemplate",e.lib.artTemplate),e.reg("klassmanager",e.klass.KlassManager)}),MX.kindle("jquery",function(e,t){var n=["hasOwnProperty","valueOf","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","constructor"],r=[],i=function(){},s=function(e){i.prototype=e;var t=new i;return i.prototype=null,t},o=function(){};t.extend(o,{$isClass:!0,addMembers:function(e){var t=this.prototype,r=[],i,s,o,u;for(o in e)r.push(o);n&&r.push.apply(r,n);for(i=0,s=r.length;i<s;i++)o=r[i],e.hasOwnProperty(o)&&(u=e[o],typeof u=="function"&&!u.$isClass&&(u.$owner=this,u.$name=o),t[o]=u);return this},extend:function(e){var t=e.prototype,n,r,i;r=this.prototype=s(t),this.superclass=r.superclass=t;if(!e.$isClass){n=o.prototype;for(i in n)i in r&&(r[i]=n[i])}}}),t.extend(o.prototype,{$isInstance:!0,callParent:function(t){var n,i=(n=this.callParent.caller)&&(n=n.$owner?n:n.caller)&&n.$owner.superclass[n.$name];return i.apply(this,e.toArray(t)||r)},constructor:function(){return this}}),e.klass.Base=o,e.reg("base",o)}),MX.kindle("base","klassmanager",function(e,t,n){var r=function(){function e(){return this.constructor.apply(this,arguments)||null}return e},i=function(r,i){var s=t.prototype,o=i.extend,u,a,f;delete i.extend,e.isString(o)&&(o=n.get(o)),o&&o!==Object?u=o:u=t,a=u.prototype;if(!u.$isClass)for(f in s)a[f]||(a[f]=s[f]);r.extend(u)};e.klass.Klass={define:function(n){var s,o;n||(n={}),s=r();for(o in t)s[o]=t[o];return i(s,n),s.addMembers(n),n.alias&&e.reg(n.alias,s),s},override:function(e,t){e.addMembers(t)}},e.reg("klass",e.klass.Klass)}),MX.kindle("jquery","klass",function(t,n,r){function s(e,t,n,r){return function(){return e.removeListener(t,n,r),n.apply(r,arguments)}}var i=/^(?:scope|delay|buffer|single|stopEvent|preventDefault|stopPropagation|normalized|args|delegate)$/,o=r.define({alias:"dispatcher",constructor:function(t,n){this.events={},this.defaultScope=n||e,t&&this.addListener(t)},addEvents:function(e){var n,r,i=this.events;if(t.isString(e)){n=arguments,r=n.length;while(r--)i[n[r]]=i[n[r]]||[]}else t.each(e,function(e,t){i[e]=i[e]||[]})},addListener:function(e,n,r,s){if(!t.isString(e)){var r=e.scope,o,u;for(u in e){if(i.test(u))continue;o=e[u],t.isFunction(o)?this.addListener(u,o,r):this.addListener(u,o.fn,o.scope||r)}return}var a=this.events;e=e.toLowerCase(),a[e]=a[e]||[],r=r||this.defaultScope,s=s||{},a[e].push({single:s.single,fireFn:n,listenerFn:this.createListener(e,n,r,s),scope:r})},removeListener:function(e,n,r){e=e.toLowerCase();var i=this.events[e];if(t.isArray(i)){r=r||this.defaultScope;for(var s=0,o=i.length;s<o;s++)if(i[s].fireFn==n&&r==i[s].scope){i.splice(s,1);return}}},clearListeners:function(e){this.events[e.toLowerCase()]=[]},purgeListeners:function(){for(var e in this.events)this.clearListeners(e)},hasListener:function(e){var n=this.events[e.toLowerCase()];return t.isArray(n)&&n.length>0},fireEvent:function(e){var n=this.events[e.toLowerCase()];if(t.isArray(n)){var r=Array.prototype.slice.call(arguments,1),i=n.length,s=0,o;if(i>0)for(;s<i;s++){o=n[s];if(o){o.single===!0&&s--;if(o.listenerFn.apply(o.scope,r)===!1)return!1}}}},createListener:function(e,t,n,r){var i=t;return r=r||{},r.single&&(i=s(this,e,t,n)),i}});n.extend(o.prototype,{on:o.prototype.addListener,un:o.prototype.removeListener}),t.util.Dispatcher=o}),MX.kindle("jquery","klass","dispatcher",function(e,t,n,r){function o(e){return(e||"gen-id")+ ++i}function u(e,t,n,r,i,s){return function(){return e.mun(t,n,r,i,s),i.apply(s,arguments)}}var i=1e3,s=/^(?:scope|delay|buffer|single|stopEvent|preventDefault|stopPropagation|normalized|args|delegate)$/;e.klass.Utility=n.define({alias:"utility",constructor:function(e){e=e||{},t.extend(this,e),this.initialConfig=e,this.id||(this.id=o(this.idPrefix||"")),this.ob=new r(this.listeners,this),delete this.listeners,this.relayMethod(this.ob,"addEvents","fireEvent","addListener","removeListener","on","un"),this.addEvents("beforedestroy","destroy"),this.init(),this.initEvents()},init:e.emptyFn,initEvents:e.emptyFn,relayMethod:function(e){var t=Array.prototype.slice.call(arguments,1),n,r,i,s;for(i=0,s=t.length;i<s;i++)n=t[i],r=e[n],!this[n]&&r&&(this[n]=function(t){return function(){return t.apply(e,arguments)}}(r))},createEventCache:function(){this.eventCaches||(this.eventCaches=[])},clearEventCache:function(){if(this.eventCaches){var e=this.eventCaches.length-1,t;for(;e>=0;e--)t=this.eventCaches[e],this.mun(t,t.type,t.selector,t.fn,t.scope)}},mon:function(n,r,i,o,u,a){var f,l,c,h=!0;this.createEventCache();if(e.isObject(r)){u=r.scope||this;for(l in r){if(s.test(l))continue;f=r[l],e.isFunction(f)?this.mon(n,l,undefined,f,u,undefined):this.mon(n,l,f.selector,f.fn,f.scope||u,f.options||a)}return}e.isFunction(i)&&(a=u,u=o,o=i,i=undefined);if(!n.$isInstance){h=!1,n=t(n);if(n.length>1){e.each(n,function(e,t){this.mon(t,r,i,o,u,a)},this);return}}u=u||this,a=a||{},h||(c=this.createListener(n,r,i,o,u,a)),this.eventCaches.push({isClass:h,item:n,type:r,selector:i,fn:o,proxyFn:c,scope:u,options:a}),h?n.on&&n.on(r,o,u,a):n.on(r,i,undefined,c)},createListener:function(e,n,r,i,s,o){var a=t.proxy(i,s);return o=o||{},o.single&&(a=u(this,e,n,r,i,s)),a},mun:function(n,r,i,o,u){var a=!!n.$isInstance,f,l,c,h;this.createEventCache(),a||(n=t(n));if(!r){for(c=0,h=this.eventCaches.length;c<h;c++)f=this.eventCaches[c],(a?n==f.item:n.is(f.item))&&this.mun(n,f.type,f.selector,f.fn,f.scope);return}if(e.isObject(r)){u=r.scope||this;for(l in r){if(s.test(l))continue;f=r[l],e.isFunction(f)?this.mun(n,l,f.data,f,u):this.mun(n,l,f.selector,f.fn,f.scope||u)}return}e.isFunction(i)&&(u=o,o=i,i=undefined),u=u||this;for(c=0,h=this.eventCaches.length;c<h;c++){f=this.eventCaches[c];if((a?n==f.item:n.is(f.item))&&r==f.type&&i==f.selector&&o==f.fn&&u==f.scope){this.eventCaches.splice(c,1),a?n.un&&n.un(r,o,u):n.off(r,i,undefined,f.proxyFn);break}}},beforeDestroy:e.emptyFn,onDestroy:e.emptyFn,destroy:function(){this.isDestroyed||this.fireEvent("beforedestroy",this)!==!1&&(this.destroying=!0,this.beforeDestroy(),this.clearEventCache(),this.onDestroy(),this.fireEvent("destroy",this),this.ob.purgeListeners(),this.destroying=!1,this.isDestroyed=!0)}})}),MX.kindle(function(t){var n=e.localStorage,r=e.JSON,i={globalPrefix:"",set:function(e,t){try{n.setItem(i.globalPrefix+e,r.stringify(t))}catch(s){}},get:function(e){try{return r.parse(n.getItem(i.globalPrefix+e))}catch(t){}return""},remove:function(e){n.removeItem(i.globalPrefix+e)}};t.util.LocalStorage=i,t.reg("localstorage",i)}),MX.kindle("jquery",function(e,t){function o(e){if(e&&e.length>0){var t=e.split("-"),n=1,r=t.length,i=[];i.push(t[0]);for(;n<r;n++)i.push(u.capitalize(t[n]));e=i.join("")}return e}var n=/\{(\d+)\}/g,r=/('|\\)/g,i=/([-.*+?\^${}()|\[\]\/\\])/g,s=.9.toFixed()!=="1",u=e.util.Format={leftPad:function(e,t,n){var r=String(e);n=n||" ";while(r.length<t)r=n+r;return r},format:function(e){var t=Array.prototype.slice.call(arguments,1);return e.replace(n,function(e,n){return t[n]})},capitalize:function(e){return e.length>0?e.charAt(0).toUpperCase()+e.substr(1):e},uncapitalize:function(e){return e.length>0?e.charAt(0).toLowerCase()+e.substr(1):e},toCamelCase:function(t){if(e.isObject(t)){var n={};return e.each(t,function(e,t){n[o(e)]=t}),n}return o(t)},urlAppend:function(t,n){t+=t.indexOf("?")===-1?"?":"&";if(e.isString(n))t+=n;else{var r=[];e.each(n,function(e,t){r.push(e+"="+(t||""))}),t+=r.join("&")}return t.charAt(t.length-1)=="?"&&(t=t.substring(0,t.length-1)),t},escapeRegex:function(e){return e.replace(i,"\\$1")},escape:function(e){return e.replace(r,"\\$1")},numberToFixed:s?function(e,t){t=t||0;var n=Math.pow(10,t);return(Math.round(e*n)/n).toFixed(t)}:function(e,t){return e.toFixed(t)},from:function(e,t){return isFinite(e)&&(e=parseFloat(e)),isNaN(e)?t:e}};e.reg("format",u)}),MX.kindle(function(t){function n(e){var t=Array.prototype.slice.call(arguments,1);return e.replace(/\{(\d+)\}/g,function(e,n){return t[n]})}t.util.DateFormat={now:Date.now||function(){return+(new Date)},toString:function(e){var n=t.util.Format.leftPad;return e.getFullYear()+"-"+n(e.getMonth()+1,2,"0")+"-"+n(e.getDate(),2,"0")+"T"+n(e.getHours(),2,"0")+":"+n(e.getMinutes(),2,"0")+":"+n(e.getSeconds(),2,"0")},getElapsed:function(e,t){return Math.abs(e-(t||new Date))},useStrict:!1,formatCodeToRegex:function(e,i){var s=r.parseCodes[e];return s&&(s=typeof s=="function"?s():s,r.parseCodes[e]=s),s?t.applyIf({c:s.c?n(s.c,i||"{0}"):s.c},s):{g:0,c:null,s:t.util.Format.escapeRegex(e)}},parseFunctions:{MS:function(e,t){var n=new RegExp("\\/Date\\(([-+])?(\\d+)(?:[+-]\\d{4})?\\)\\/"),r=(e||"").match(n);return r?new Date(((r[1]||"")+r[2])*1):null}},parseRegexes:[],formatFunctions:{MS:function(){return"\\/Date("+this.getTime()+")\\/"}},y2kYear:50,MILLI:"ms",SECOND:"s",MINUTE:"mi",HOUR:"h",DAY:"d",MONTH:"mo",YEAR:"y",defaults:{},dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNumbers:{January:0,Jan:0,February:1,Feb:1,March:2,Mar:2,April:3,Apr:3,May:4,June:5,Jun:5,July:6,Jul:6,August:7,Aug:7,September:8,Sep:8,October:9,Oct:9,November:10,Nov:10,December:11,Dec:11},defaultFormat:"m/d/Y",getShortMonthName:function(e){return t.util.DateFormat.monthNames[e].substring(0,3)},getShortDayName:function(e){return t.util.DateFormat.dayNames[e].substring(0,3)},getMonthNumber:function(e){return t.util.DateFormat.monthNumbers[e.substring(0,1).toUpperCase()+e.substring(1,3).toLowerCase()]},formatContainsHourInfo:function(){var e=/(\\.)/g,t=/([gGhHisucUOPZ]|MS)/;return function(n){return t.test(n.replace(e,""))}}(),formatContainsDateInfo:function(){var e=/(\\.)/g,t=/([djzmnYycU]|MS)/;return function(n){return t.test(n.replace(e,""))}}(),unescapeFormat:function(){var e=/\\/gi;return function(t){return t.replace(e,"")}}(),formatCodes:{d:"MX.util.Format.leftPad(this.getDate(), 2, '0')",D:"MX.util.DateFormat.getShortDayName(this.getDay())",j:"this.getDate()",l:"MX.util.DateFormat.dayNames[this.getDay()]",N:"(this.getDay() ? this.getDay() : 7)",S:"MX.util.DateFormat.getSuffix(this)",w:"this.getDay()",z:"MX.util.DateFormat.getDayOfYear(this)",W:"MX.util.Format.leftPad(MX.util.DateFormat.getWeekOfYear(this), 2, '0')",F:"MX.util.DateFormat.monthNames[this.getMonth()]",m:"MX.util.Format.leftPad(this.getMonth() + 1, 2, '0')",M:"MX.util.DateFormat.getShortMonthName(this.getMonth())",n:"(this.getMonth() + 1)",t:"MX.util.DateFormat.getDaysInMonth(this)",L:"(MX.util.DateFormat.isLeapYear(this) ? 1 : 0)",o:"(this.getFullYear() + (MX.util.DateFormat.getWeekOfYear(this) == 1 && this.getMonth() > 0 ? +1 : (MX.util.DateFormat.getWeekOfYear(this) >= 52 && this.getMonth() < 11 ? -1 : 0)))",Y:"MX.util.Format.leftPad(this.getFullYear(), 4, '0')",y:"('' + this.getFullYear()).substring(2, 4)",a:"(this.getHours() < 12 ? 'am' : 'pm')",A:"(this.getHours() < 12 ? 'AM' : 'PM')",g:"((this.getHours() % 12) ? this.getHours() % 12 : 12)",G:"this.getHours()",h:"MX.util.Format.leftPad((this.getHours() % 12) ? this.getHours() % 12 : 12, 2, '0')",H:"MX.util.Format.leftPad(this.getHours(), 2, '0')",i:"MX.util.Format.leftPad(this.getMinutes(), 2, '0')",s:"MX.util.Format.leftPad(this.getSeconds(), 2, '0')",u:"MX.util.Format.leftPad(this.getMilliseconds(), 3, '0')",O:"MX.util.DateFormat.getGMTOffset(this)",P:"MX.util.DateFormat.getGMTOffset(this, true)",T:"MX.util.DateFormat.getTimezone(this)",Z:"(this.getTimezoneOffset() * -60)",c:function(){var e,t,n,i,s;for(e="Y-m-dTH:i:sP",t=[],n=0,i=e.length;n<i;++n)s=e.charAt(n),t.push(s=="T"?"'T'":r.getFormatCode(s));return t.join(" + ")},U:"Math.round(this.getTime() / 1000)"},isValid:function(e,t,n,i,s,o,u){i=i||0,s=s||0,o=o||0,u=u||0;var a=r.add(new Date(e<100?100:e,t-1,n,i,s,o,u),r.YEAR,e<100?e-100:0);return e==a.getFullYear()&&t==a.getMonth()+1&&n==a.getDate()&&i==a.getHours()&&s==a.getMinutes()&&o==a.getSeconds()&&u==a.getMilliseconds()},parse:function(e,n,i){var s=r.parseFunctions;return s[n]==null&&r.createParser(n),s[n](e,t.isDefined(i)?i:r.useStrict)},parseDate:function(e,t,n){return r.parse(e,t,n)},getFormatCode:function(e){var n=r.formatCodes[e];return n&&(n=typeof n=="function"?n():n,r.formatCodes[e]=n),n||"'"+t.util.Format.escape(e)+"'"},createFormat:function(e){var n=[],i=!1,s="",o;for(o=0;o<e.length;++o)s=e.charAt(o),!i&&s=="\\"?i=!0:i?(i=!1,n.push("'"+t.util.Format.escape(s)+"'")):n.push(r.getFormatCode(s));r.formatFunctions[e]=Function.prototype.constructor.apply(Function.prototype,["return "+n.join("+")])},createParser:function(){var e=["var dt, y, m, d, h, i, s, ms, o, z, zz, u, v,","def = MX.util.DateFormat.defaults,","results = String(input).match(MX.util.DateFormat.parseRegexes[{0}]);","if(results){","{1}","if(u != null){","v = new Date(u * 1000);","}else{","dt = MX.util.DateFormat.clearTime(new Date);","y = MX.util.Format.from(y, MX.util.Format.from(def.y, dt.getFullYear()));","m = MX.util.Format.from(m, MX.util.Format.from(def.m - 1, dt.getMonth()));","d = MX.util.Format.from(d, MX.util.Format.from(def.d, dt.getDate()));","h  = MX.util.Format.from(h, MX.util.Format.from(def.h, dt.getHours()));","i  = MX.util.Format.from(i, MX.util.Format.from(def.i, dt.getMinutes()));","s  = MX.util.Format.from(s, MX.util.Format.from(def.s, dt.getSeconds()));","ms = MX.util.Format.from(ms, MX.util.Format.from(def.ms, dt.getMilliseconds()));","if(z >= 0 && y >= 0){","v = MX.util.DateFormat.add(new Date(y < 100 ? 100 : y, 0, 1, h, i, s, ms), MX.util.DateFormat.YEAR, y < 100 ? y - 100 : 0);","v = !strict? v : (strict === true && (z <= 364 || (MX.util.DateFormat.isLeapYear(v) && z <= 365))? MX.util.DateFormat.add(v, MX.util.DateFormat.DAY, z) : null);","}else if(strict === true && !MX.util.DateFormat.isValid(y, m + 1, d, h, i, s, ms)){","v = null;","}else{","v = MX.util.DateFormat.add(new Date(y < 100 ? 100 : y, m, d, h, i, s, ms), MX.util.DateFormat.YEAR, y < 100 ? y - 100 : 0);","}","}","}","if(v){","if(zz != null){","v = MX.util.DateFormat.add(v, MX.util.DateFormat.SECOND, -v.getTimezoneOffset() * 60 - zz);","}else if(o){","v = MX.util.DateFormat.add(v, MX.util.DateFormat.MINUTE, -v.getTimezoneOffset() + (sn == '+'? -1 : 1) * (hr * 60 + mn));","}","}","return v;"].join("\n");return function(i){var s=r.parseRegexes.length,o=1,u=[],a=[],f=!1,l="",c=0,h=i.length,p=[],d;for(;c<h;++c)l=i.charAt(c),!f&&l=="\\"?f=!0:f?(f=!1,a.push(t.util.Format.escape(l))):(d=r.formatCodeToRegex(l,o),o+=d.g,a.push(d.s),d.g&&d.c&&(d.calcAtEnd?p.push(d.c):u.push(d.c)));u=u.concat(p),r.parseRegexes[s]=new RegExp("^"+a.join("")+"$","i"),r.parseFunctions[i]=Function.prototype.constructor.apply(Function.prototype,["input","strict",n(e,s,u.join(""))])}}(),parseCodes:{d:{g:1,c:"d = parseInt(results[{0}], 10);\n",s:"(3[0-1]|[1-2][0-9]|0[1-9])"},j:{g:1,c:"d = parseInt(results[{0}], 10);\n",s:"(3[0-1]|[1-2][0-9]|[1-9])"},D:function(){for(var e=[],t=0;t<7;e.push(r.getShortDayName(t)),++t);return{g:0,c:null,s:"(?:"+e.join("|")+")"}},l:function(){return{g:0,c:null,s:"(?:"+r.dayNames.join("|")+")"}},N:{g:0,c:null,s:"[1-7]"},S:{g:0,c:null,s:"(?:st|nd|rd|th)"},w:{g:0,c:null,s:"[0-6]"},z:{g:1,c:"z = parseInt(results[{0}], 10);\n",s:"(\\d{1,3})"},W:{g:0,c:null,s:"(?:\\d{2})"},F:function(){return{g:1,c:"m = parseInt(MX.util.DateFormat.getMonthNumber(results[{0}]), 10);\n",s:"("+r.monthNames.join("|")+")"}},M:function(){for(var e=[],n=0;n<12;e.push(r.getShortMonthName(n)),++n);return t.applyIf({s:"("+e.join("|")+")"},r.formatCodeToRegex("F"))},m:{g:1,c:"m = parseInt(results[{0}], 10) - 1;\n",s:"(1[0-2]|0[1-9])"},n:{g:1,c:"m = parseInt(results[{0}], 10) - 1;\n",s:"(1[0-2]|[1-9])"},t:{g:0,c:null,s:"(?:\\d{2})"},L:{g:0,c:null,s:"(?:1|0)"},o:function(){return r.formatCodeToRegex("Y")},Y:{g:1,c:"y = parseInt(results[{0}], 10);\n",s:"(\\d{4})"},y:{g:1,c:"var ty = parseInt(results[{0}], 10);\ny = ty > MX.util.DateFormat.y2kYear ? 1900 + ty : 2000 + ty;\n",s:"(\\d{1,2})"},a:{g:1,c:"if (/(am)/i.test(results[{0}])) {\nif (!h || h == 12) { h = 0; }\n} else { if (!h || h < 12) { h = (h || 0) + 12; }}",s:"(am|pm|AM|PM)",calcAtEnd:!0},A:{g:1,c:"if (/(am)/i.test(results[{0}])) {\nif (!h || h == 12) { h = 0; }\n} else { if (!h || h < 12) { h = (h || 0) + 12; }}",s:"(AM|PM|am|pm)",calcAtEnd:!0},g:{g:1,c:"h = parseInt(results[{0}], 10);\n",s:"(1[0-2]|[0-9])"},G:{g:1,c:"h = parseInt(results[{0}], 10);\n",s:"(2[0-3]|1[0-9]|[0-9])"},h:{g:1,c:"h = parseInt(results[{0}], 10);\n",s:"(1[0-2]|0[1-9])"},H:{g:1,c:"h = parseInt(results[{0}], 10);\n",s:"(2[0-3]|[0-1][0-9])"},i:{g:1,c:"i = parseInt(results[{0}], 10);\n",s:"([0-5][0-9])"},s:{g:1,c:"s = parseInt(results[{0}], 10);\n",s:"([0-5][0-9])"},u:{g:1,c:"ms = results[{0}]; ms = parseInt(ms, 10)/Math.pow(10, ms.length - 3);\n",s:"(\\d+)"},O:{g:1,c:["o = results[{0}];","var sn = o.substring(0,1),","hr = o.substring(1,3)*1 + Math.floor(o.substring(3,5) / 60),","mn = o.substring(3,5) % 60;","o = ((-12 <= (hr*60 + mn)/60) && ((hr*60 + mn)/60 <= 14))? (sn + MX.util.Format.leftPad(hr, 2, '0') + MX.util.Format.leftPad(mn, 2, '0')) : null;\n"].join("\n"),s:"([+-]\\d{4})"},P:{g:1,c:["o = results[{0}];","var sn = o.substring(0,1),","hr = o.substring(1,3)*1 + Math.floor(o.substring(4,6) / 60),","mn = o.substring(4,6) % 60;","o = ((-12 <= (hr*60 + mn)/60) && ((hr*60 + mn)/60 <= 14))? (sn + MX.util.Format.leftPad(hr, 2, '0') + MX.util.Format.leftPad(mn, 2, '0')) : null;\n"].join("\n"),s:"([+-]\\d{2}:\\d{2})"},T:{g:0,c:null,s:"[A-Z]{1,4}"},Z:{g:1,c:"zz = results[{0}] * 1;\nzz = (-43200 <= zz && zz <= 50400)? zz : null;\n",s:"([+-]?\\d{1,5})"},c:function(){var e=[],t=[r.formatCodeToRegex("Y",1),r.formatCodeToRegex("m",2),r.formatCodeToRegex("d",3),r.formatCodeToRegex("H",4),r.formatCodeToRegex("i",5),r.formatCodeToRegex("s",6),{c:"ms = results[7] || '0'; ms = parseInt(ms, 10)/Math.pow(10, ms.length - 3);\n"},{c:["if(results[8]) {","if(results[8] == 'Z'){","zz = 0;","}else if (results[8].indexOf(':') > -1){",r.formatCodeToRegex("P",8).c,"}else{",r.formatCodeToRegex("O",8).c,"}","}"].join("\n")}],n,i;for(n=0,i=t.length;n<i;++n)e.push(t[n].c);return{g:1,c:e.join(""),s:[t[0].s,"(?:","-",t[1].s,"(?:","-",t[2].s,"(?:","(?:T| )?",t[3].s,":",t[4].s,"(?::",t[5].s,")?","(?:(?:\\.|,)(\\d+))?","(Z|(?:[-+]\\d{2}(?::)?\\d{2}))?",")?",")?",")?"].join("")}},U:{g:1,c:"u = parseInt(results[{0}], 10);\n",s:"(-?\\d+)"}},dateFormat:function(e,t){return r.format(e,t)},isEqual:function(e,t){return e&&t?e.getTime()===t.getTime():!e&&!t},format:function(e,n){var i=r.formatFunctions;return t.isDate(e)?(i[n]==null&&r.createFormat(n),i[n].call(e)+""):""},getTimezone:function(e){return e.toString().replace(/^.* (?:\((.*)\)|([A-Z]{1,4})(?:[\-+][0-9]{4})?(?: -?\d+)?)$/,"$1$2").replace(/[^A-Z]/g,"")},getGMTOffset:function(e,n){var r=e.getTimezoneOffset();return(r>0?"-":"+")+t.util.Format.leftPad(Math.floor(Math.abs(r)/60),2,"0")+(n?":":"")+t.util.Format.leftPad(Math.abs(r%60),2,"0")},getDayOfYear:function(e){var n=0,i=t.util.DateFormat.clone(e),s=e.getMonth(),o;for(o=0,i.setDate(1),i.setMonth(0);o<s;i.setMonth(++o))n+=r.getDaysInMonth(i);return n+e.getDate()-1},getWeekOfYear:function(){var e=864e5,t=7*e;return function(n){var r=Date.UTC(n.getFullYear(),n.getMonth(),n.getDate()+3)/e,i=Math.floor(r/7),s=(new Date(i*t)).getUTCFullYear();return i-Math.floor(Date.UTC(s,0,7)/t)+1}}(),isLeapYear:function(e){var t=e.getFullYear();return(t&3)==0&&!!(t%100||t%400==0&&t)},getFirstDayOfMonth:function(e){var t=(e.getDay()-(e.getDate()-1))%7;return t<0?t+7:t},getLastDayOfMonth:function(e){return r.getLastDateOfMonth(e).getDay()},getFirstDateOfMonth:function(e){return new Date(e.getFullYear(),e.getMonth(),1)},getLastDateOfMonth:function(e){return new Date(e.getFullYear(),e.getMonth(),r.getDaysInMonth(e))},getDaysInMonth:function(){var e=[31,28,31,30,31,30,31,31,30,31,30,31];return function(t){var n=t.getMonth();return n==1&&r.isLeapYear(t)?29:e[n]}}(),getSuffix:function(e){switch(e.getDate()){case 1:case 21:case 31:return"st";case 2:case 22:return"nd";case 3:case 23:return"rd";default:return"th"}},clone:function(e){return new Date(e.getTime())},isDST:function(e){return(new Date(e.getFullYear(),0,1)).getTimezoneOffset()!=e.getTimezoneOffset()},clearTime:function(e,n){if(n)return t.util.DateFormat.clearTime(t.util.DateFormat.clone(e));var i=e.getDate(),s,o;e.setHours(0),e.setMinutes(0),e.setSeconds(0),e.setMilliseconds(0);if(e.getDate()!=i){for(s=1,o=r.add(e,t.util.DateFormat.HOUR,s);o.getDate()!=i;s++,o=r.add(e,t.util.DateFormat.HOUR,s));e.setDate(i),e.setHours(o.getHours())}return e},add:function(e,n,r){var i=t.util.DateFormat.clone(e),s=t.util.DateFormat,o;if(!n||r===0)return i;switch(n.toLowerCase()){case t.util.DateFormat.MILLI:i.setMilliseconds(i.getMilliseconds()+r);break;case t.util.DateFormat.SECOND:i.setSeconds(i.getSeconds()+r);break;case t.util.DateFormat.MINUTE:i.setMinutes(i.getMinutes()+r);break;case t.util.DateFormat.HOUR:i.setHours(i.getHours()+r);break;case t.util.DateFormat.DAY:i.setDate(i.getDate()+r);break;case t.util.DateFormat.MONTH:o=e.getDate(),o>28&&(o=Math.min(o,t.util.DateFormat.getLastDateOfMonth(t.util.DateFormat.add(t.util.DateFormat.getFirstDateOfMonth(e),t.util.DateFormat.MONTH,r)).getDate())),i.setDate(o),i.setMonth(e.getMonth()+r);break;case t.util.DateFormat.YEAR:o=e.getDate(),o>28&&(o=Math.min(o,t.util.DateFormat.getLastDateOfMonth(t.util.DateFormat.add(t.util.DateFormat.getFirstDateOfMonth(e),t.util.DateFormat.YEAR,r)).getDate())),i.setDate(o),i.setFullYear(e.getFullYear()+r)}return i},between:function(e,t,n){var r=e.getTime();return t.getTime()<=r&&r<=n.getTime()},compat:function(){var t=e.Date,n,i,s=["useStrict","formatCodeToRegex","parseFunctions","parseRegexes","formatFunctions","y2kYear","MILLI","SECOND","MINUTE","HOUR","DAY","MONTH","YEAR","defaults","dayNames","monthNames","monthNumbers","getShortMonthName","getShortDayName","getMonthNumber","formatCodes","isValid","parseDate","getFormatCode","createFormat","createParser","parseCodes"],o=["dateFormat","format","getTimezone","getGMTOffset","getDayOfYear","getWeekOfYear","isLeapYear","getFirstDayOfMonth","getLastDayOfMonth","getDaysInMonth","getSuffix","clone","isDST","clearTime","add","between"],u=s.length,a=o.length,f,l,c;for(c=0;c<u;c++)f=s[c],t[f]=r[f];for(n=0;n<a;n++)l=o[n],t.prototype[l]=function(){var e=Array.prototype.slice.call(arguments);return e.unshift(this),r[l].apply(r,e)}}};var r=t.util.DateFormat;t.reg("dateformat",t.util.DateFormat)}),MX.kindle("jquery","klass",function(t,n,r){var i=function(e){return e.replace(/([-.*+?^${}()|[\]\/\\])/g,"\\$1")};t.util.Collection=r.define({alias:"collection",extend:"utility",allowFunctions:!1,init:function(){this.items=[],this.map={},this.keys=[],this.length=0},initEvents:function(){this.addEvents("clear","add","replace","remove","sort")},add:function(e,t){arguments.length==1&&(t=arguments[0],e=this.getKey(t));if(typeof e!="undefined"&&e!==null){var n=this.map[e];if(typeof n!="undefined")return this.replace(e,t);this.map[e]=t}return this.length++,this.items.push(t),this.keys.push(e),this.fireEvent("add",this.length-1,t,e),t},getKey:function(e){return e.id},replace:function(e,t){arguments.length==1&&(t=arguments[0],e=this.getKey(t));var n=this.map[e];if(typeof e=="undefined"||e===null||typeof n=="undefined")return this.add(e,t);var r=this.indexOfKey(e);return this.items[r]=t,this.map[e]=t,this.fireEvent("replace",e,n,t),t},addAll:function(e){if(arguments.length>1||t.isArray(e)){var n=arguments.length>1?arguments:e;for(var r=0,i=n.length;r<i;r++)this.add(n[r])}else for(var s in e)(this.allowFunctions||typeof e[s]!="function")&&this.add(s,e[s])},each:function(e,t){var n=[].concat(this.items);for(var r=0,i=n.length;r<i;r++)if(e.call(t||n[r],n[r],r,i)===!1)break},eachKey:function(t,n){for(var r=0,i=this.keys.length;r<i;r++)t.call(n||e,this.keys[r],this.items[r],r,i)},find:function(t,n){for(var r=0,i=this.items.length;r<i;r++)if(t.call(n||e,this.items[r],this.keys[r]))return this.items[r];return null},insert:function(e,t,n){return arguments.length==2&&(n=arguments[1],t=this.getKey(n)),this.containsKey(t)&&(this.suspendEvents(),this.removeKey(t),this.resumeEvents()),e>=this.length?this.add(t,n):(this.length++,this.items.splice(e,0,n),typeof t!="undefined"&&t!==null&&(this.map[t]=n),this.keys.splice(e,0,t),this.fireEvent("add",e,n,t),n)},remove:function(e){return this.removeAt(this.indexOf(e))},removeAt:function(e){if(e<this.length&&e>=0){this.length--;var t=this.items[e];this.items.splice(e,1);var n=this.keys[e];return typeof n!="undefined"&&delete this.map[n],this.keys.splice(e,1),this.fireEvent("remove",t,n),t}return!1},removeKey:function(e){return this.removeAt(this.indexOfKey(e))},getCount:function(){return this.length},indexOf:function(e){return this.items.indexOf(e)},indexOfKey:function(e){return this.keys.indexOf(e)},item:function(e){var t=this.map[e],n=t!==undefined?t:typeof e=="number"?this.items[e]:undefined;return typeof n!="function"||this.allowFunctions?n:null},itemAt:function(e){return this.items[e]},key:function(e){return this.map[e]},contains:function(e){return this.indexOf(e)!=-1},containsKey:function(e){return typeof this.map[e]!="undefined"},clear:function(){this.length=0,this.items=[],this.keys=[],this.map={},this.fireEvent("clear")},first:function(){return this.items[0]},last:function(){return this.items[this.length-1]},_sort:function(e,t,n){var r,i,s=String(t).toUpperCase()=="DESC"?-1:1,o=[],u=this.keys,a=this.items;n=n||function(e,t){return e-t};for(r=0,i=a.length;r<i;r++)o[o.length]={key:u[r],value:a[r],index:r};o.sort(function(t,r){var i=n(t[e],r[e])*s;return i===0&&(i=t.index<r.index?-1:1),i});for(r=0,i=o.length;r<i;r++)a[r]=o[r].value,u[r]=o[r].key;this.fireEvent("sort",this)},sort:function(e,t){this._sort("value",e,t)},reorder:function(e){this.suspendEvents();var t=this.items,n=0,r=t.length,i=[],s=[],o;for(o in e)i[e[o]]=t[o];for(n=0;n<r;n++)e[n]==undefined&&s.push(t[n]);for(n=0;n<r;n++)i[n]==undefined&&(i[n]=s.shift());this.clear(),this.addAll(i),this.resumeEvents(),this.fireEvent("sort",this)},keySort:function(e,t){this._sort("key",e,t||function(e,t){var n=String(e).toUpperCase(),r=String(t).toUpperCase();return n>r?1:n<r?-1:0})},getRange:function(e,t){var n=this.items;if(n.length<1)return[];e=e||0,t=Math.min(typeof t=="undefined"?this.length-1:t,this.length-1);var r,i=[];if(e<=t)for(r=e;r<=t;r++)i[i.length]=n[r];else for(r=e;r>=t;r--)i[i.length]=n[r];return i},filter:function(e,n,r,i){return t.isEmpty(n,!1)?this.clone():(n=this.createValueMatcher(n,r,i),this.filterBy(function(t){return t&&n.test(t[e])}))},filterBy:function(e,n){var r=new t.util.Collection;r.getKey=this.getKey;var i=this.keys,s=this.items;for(var o=0,u=s.length;o<u;o++)e.call(n||this,s[o],i[o])&&r.add(i[o],s[o]);return r},findIndex:function(e,n,r,i,s){return t.isEmpty(n,!1)?-1:(n=this.createValueMatcher(n,i,s),this.findIndexBy(function(t){return t&&n.test(t[e])},null,r))},findIndexBy:function(e,t,n){var r=this.keys,i=this.items;for(var s=n||0,o=i.length;s<o;s++)if(e.call(t||this,i[s],r[s]))return s;return-1},createValueMatcher:function(e,t,n,r){return e.exec||(e=String(e),t===!0?e=i(e):(e="^"+i(e),r===!0&&(e+="$")),e=new RegExp(e,n?"":"i")),e},clone:function(){var e=new t.util.Collection,n=this.keys,r=this.items;for(var i=0,s=r.length;i<s;i++)e.add(n[i],r[i]);return e.getKey=this.getKey,e}})}),MX.kindle("jquery","arttemplate","klass",function(e,t,n,r){e.app.Template=r.define({alias:"template",extend:"utility",init:function(){this.template?e.isString(this.template)&&(this.template=n(this.template)):this.template=n(t(this.target||"#"+this.id).html()),this.store&&(this.bindStore(this.store,!0),delete this.store)},applyTemplate:function(e){return this.template?(e=this.getData(this.params,e||{}),this.template(e||{})):""},render:function(t,n){e.isObject(t)&&(n=t,t=null),t=t||this.container,t.html(this.applyTemplate(n))},getData:function(e,t){return t},bindStore:function(e,t){t!==!0&&this.unbindStore(),e&&(this.store=e,this.mon(this.store,"load",this.onStoreLoad))},unbindStore:function(){this.store&&(this.mun(this.store,"load",this.onStoreLoad),this.store=null)},onStoreLoad:function(){var e,t=this.store;t.isModel?e=t.get():(e={},e[t.dataProperty]=t.get()),this.render(e)},onDestroy:function(){this.unbindStore()}})}),MX.kindle("klass","dateformat",function(n,r,i){n.app.Model=r.define({alias:"model",extend:"utility",isModel:!0,useWebDatabase:!0,useCache:!1,cacheExpires:6e5,requestMethod:"GET",dataType:"json",idProperty:"id",dataProperty:"data",showPageLoading:!1,init:function(){this.baseParams=this.baseParams||{},this.initRestful(),this.initFields(),this.initTable(),this.dirty=!1,this.fetched=!1,this.removed=!1,this.modified={},this.data={},this.values&&(this.set(this.values),delete this.values)},initRestful:function(){var e={create:"create",read:"read",update:"update",destroy:"destroy"},r,i;this.restful=this.restful||this.url||{},n.isString(this.restful)&&(this.restful={create:this.restful,read:this.restful,update:this.restful,destroy:this.restful}),i={},n.each(e,function(e,s){r=this.restful[s],n.isString(r)?r={url:r,type:this.requestMethod}:r=t.extend({type:this.requestMethod},r),i[s]=r},this),this.restful=i},initFields:function(){if(this.fields){var e={};n.each(this.fields,function(t,r){n.isString(r)&&(r={name:r}),e[r.name]=r},this),e[this.idProperty]||(e[this.idProperty]={name:this.idProperty}),this.fields=e}},initTable:function(){var e=this;if(!e.fields||!e.db||!e.tableName)e.useWebDatabase=!1;if(e.useWebDatabase){var n,r=e.fields,i=[],s=[];s.push(e.idProperty+" UNIQUE");for(n in r)n!=e.idProperty&&(s.push(n),i.push(n));s.push("_last_updated TIMESTAMP"),s=s.join(", "),i=i.join(","),e.db.transaction(function(n){n.executeSql("CREATE TABLE IF NOT EXISTS "+e.tableName+" ("+s+")",[],function(n,r){n.executeSql("DELETE FROM "+e.tableName+" WHERE _last_updated < ?",[t.now()-e.cacheExpires]),n.executeSql("SELECT * FROM systables WHERE table_name = ?",[e.tableName],function(t,n){n.rows.length==0&&t.executeSql("INSERT INTO systables VALUES (?)",[e.tableName])}),n.executeSql("SELECT column_name FROM syscolumns WHERE table_name = ?",[e.tableName],function(t,n){var r=!0;n.rows.length==0?t.executeSql("INSERT INTO syscolumns VALUES (?, ?)",[e.tableName,i]):n.rows.item(0)["column_name"]!=i?t.executeSql("UPDATE syscolumns SET column_name = ? WHERE table_name = ?",[i,e.tableName]):r=!1,r&&(t.executeSql("DROP TABLE "+e.tableName,[]),t.executeSql("CREATE TABLE IF NOT EXISTS "+e.tableName+" ("+s+")",[]))})})},function(e){})}},initEvents:function(){this.addEvents("datachanged","idchanged","beforeload","load","loadfailed","loadcomplete")},set:function(e,t){var r=this.data,i=this.modified,s,o,u,a,f,l,c={},h={},p,d;n.isString(e)?(p={},p[e]=t):p=e,d=this.fields||p;for(e in d)if(p.hasOwnProperty(e)){t=n.isDefined(p[e])?p[e]:"",s=r[e];if(i[e]===t){r[e]=t,c[e]=t,h[e]=s,delete i[e],u=!1;for(o in i)this.dirty=!0,u=!0;u||(this.dirty=!1)}else s!==t&&(r[e]=t,c[e]=t,h[e]=s,n.isDefined(i[e])||(i[e]=s,this.dirty=!0));e==this.idProperty&&s!==t&&(a=!0,f=s,l=t)}a&&this.fireEvent("idchanged",this,l,f),this.fireEvent("datachanged",this,c,h)},get:function(e,r){var i=this.data,s=this.fields,o;n.isBoolean(e)&&(r=e,e=null);if(r===!0||!s)o=e?i[e]:t.extend({},i);else if(e)o=this.renderData(s[e],i[e]);else{o={};for(e in s)o[e]=this.renderData(s[e],i[e])}return o},renderData:function(e,t){if(e){var r="Y-m-d H:i:s",s=e.renderer,o=e.type,u;try{s&&n.isFunction(s)?t=s.call(this,t):o=="number"?t=parseInt(t):o=="float"?t=parseFloat(t):o=="date"?t=i.parse(t,e.format||r):o=="timestamp"?(u=new Date,u.setTime(t),t=i.format(u,e.format||r)):o=="string"&&(t=""+t)}catch(a){}}return t},load:function(n,r){!this.removed&&!this.loading&&this.fireEvent("beforeload",this)!==!1&&(this.loading=!0,n=t.extend({},n,this.getFetchData(),this.getData?this.getData(this.params):null),this.showPageLoading&&this.showPageLoadingMsg(),!e.navigator.onLine||!r&&this.useWebDatabase&&this.useCache?this.loadStorage(n):this.fetch(n))},reload:function(e){this.load(e,!0)},fetch:function(e){var n;e=e||{},e._dt=t.now(),n=t.extend({},this.baseParams,{type:this.requestMethod,url:this.getUrl?this.getUrl(this.params,"read"):this.restful.read,dataType:this.dataType||"json",data:e}),this.cancelFetch(),this.lastXmlRequest=t.ajax(n).done(t.proxy(this.onFetchSuccess,this)).fail(t.proxy(this.handleLoadFailed,this)).always(t.proxy(this.handleRequestComplete,this))},getFetchData:function(){var e={};return e[this.idProperty]=this.get(this.idProperty,!0),e},cancelFetch:function(){this.lastXmlRequest&&(this.lastXmlRequest.abort(),this.lastXmlRequest=null)},onFetchSuccess:function(e,t,n){if(!e)return;e=this.dataProperty?e[this.dataProperty]:e,this.handleLoadSuccess(e),this.updateStorage()},handleLoadSuccess:function(e){this.fetched=!0,this.set(e||{}),this.modified={},this.dirty=!1,this.fireEvent("load",this)},handleLoadFailed:function(){for(var e in this.data)this.data.hasOwnProperty(e)&&e!=this.idProperty&&(this.data[e]="");this.modified={},this.dirty=!1,this.fireEvent("loadfailed",this)},handleRequestComplete:function(){this.loading=!1,this.lastXmlRequest=null,this.showPageLoading&&this.hidePageLoadingMsg(),this.fireEvent("loadcomplete",this)},sync:function(){},remove:function(e){},getStorageKey:function(){return this.get(this.idProperty,!0)},loadStorage:function(e){var n=this,r=n.getStorageKey();n.useWebDatabase&&r?n.db.transaction(function(i){i.executeSql("SELECT * FROM "+n.tableName+" WHERE "+n.idProperty+" = ?",[r],function(r,i){if(i.rows.length>0){var s,o={},u=i.rows.item(0);if(u._last_updated+n.cacheExpires<t.now())n.fetch(e);else{try{for(s in n.fields)n.fields.hasOwnProperty(s)&&(o[s]=JSON.parse(u[s]));n.handleLoadSuccess(o)}catch(a){n.handleLoadFailed()}n.handleRequestComplete()}}else n.fetch(e)})},function(e){n.handleLoadFailed(),n.handleRequestComplete()}):n.fetch(e)},updateStorage:function(){var e=this,n=e.getStorageKey();e.useWebDatabase&&n&&e.db.transaction(function(r){r.executeSql("SELECT * FROM "+e.tableName+" WHERE "+e.idProperty+" = ?",[n],function(r,i){var s,o,u=e.fields,a=e.data,f,l=[],c=[],h=[];if(i.rows.length>0){for(s in u)s!=e.idProperty&&(l.push(s+" = ?"),h.push(JSON.stringify(a[s])));l.push("_last_updated = ?"),h.push(t.now()),h.push(n),f="UPDATE "+e.tableName+" SET "+l.join(", ")+" WHERE "+e.idProperty+" = ?"}else{l.push(e.idProperty),c.push("?"),h.push(n);for(s in u)s!=e.idProperty&&(l.push(s),c.push("?"),h.push(JSON.stringify(a[s])));l.push("_last_updated"),c.push("?"),h.push(t.now()),f="INSERT INTO "+e.tableName+" ("+l.join(", ")+") VALUES ("+c.join(", ")+")"}r.executeSql(f,h)})},function(e){})},showPageLoadingMsg:function(){t.mobile.showPageLoadingMsg()},hidePageLoadingMsg:function(){t.mobile.hidePageLoadingMsg()},onDestroy:function(){this.db=null}})}),MX.kindle("jquery","klass","collection",function(t,n,r,i){t.app.Store=r.define({alias:"store",extend:"utility",isStore:!0,useWebDatabase:!0,tableName:"storepaging",useCache:!1,cacheExpires:6e5,idProperty:"id",requestMethod:"GET",dataType:"json",dataProperty:"data",pageSize:20,maxPage:Number.MAX_VALUE,showPageLoading:!1,init:function(){this.baseParams=this.baseParams||{},this.storageKey=this.storageKey||this.id,this.meta=this.meta||{},t.applyIf(this.meta,{pageNumberProperty:"page",pageSizeProperty:"pageSize",pageStartProperty:"pageStart",totalProperty:"total"}),this.initTable(),this.currentPage=1,this.total=undefined,this.fetched=!1,this.data=new i({getKey:function(e){return e.data[e.idProperty]}})},initTable:function(){var e=this;if(!e.db||!e.tableName||!e.storageKey)e.useWebDatabase=!1;e.useWebDatabase&&e.db.transaction(function(t){t.executeSql("CREATE TABLE IF NOT EXISTS "+e.tableName+" (id UNIQUE, value, _last_updated TIMESTAMP)",[],function(t,r){t.executeSql("DELETE FROM "+e.tableName+" WHERE _last_updated < ?",[n.now()-e.cacheExpires]),t.executeSql("SELECT * FROM systables WHERE table_name = ?",[e.tableName],function(t,n){n.rows.length==0&&t.executeSql("INSERT INTO systables VALUES (?)",[e.tableName])})})},function(e){})},initEvents:function(){this.addEvents("datachanged","beforeload","load","loadfailed","loadcomplete")},load:function(t,r){var i=this.maxPage,s;t=n.extend({},t,this.getData?this.getData(this.params):null),s=t.page||this.currentPage,s=s<1?1:s,t.page=s,!this.removed&&!this.loading&&s<=i&&this.fireEvent("beforeload",this,s)!==!1&&(this.loading=!0,this.toPage=s,this.showPageLoading&&this.showPageLoadingMsg(),!e.navigator.onLine||!r&&this.useWebDatabase&&this.useCache?this.loadStorage(t):this.fetch(t))},reload:function(e){e=e||{},e.page=this.currentPage,this.load(e,!0)},fetch:function(e){var t=this.meta,r=e.page,i;e[t.pageNumberProperty]=r,e[t.pageSizeProperty]=this.pageSize,e[t.pageStartProperty]=(r-1)*this.pageSize,e._dt=n.now(),i=n.extend({},this.baseParams,{type:this.requestMethod,url:this.getUrl?this.getUrl(this.params,"read"):this.url,dataType:this.dataType||"json",data:e}),this.cancelFetch(),this.lastXmlRequest=n.ajax(i).done(n.proxy(this.onFetchSuccess,this)).fail(n.proxy(this.handleLoadFailed,this)).always(n.proxy(this.handleRequestComplete,this))},cancelFetch:function(){this.lastXmlRequest&&(this.lastXmlRequest.abort(),this.lastXmlRequest=null)},onFetchSuccess:function(e,t,n){if(!e)return;var r=this.dataProperty?e[this.dataProperty]:e;this.handleLoadSuccess(r),this.updateStorage()},handleLoadSuccess:function(e){e=e||[],this.lastPage=this.currentPage,this.currentPage=this.toPage;if(e.length>0){var n=this.meta;t.isDefined(e[n.totalProperty])&&(this.total=e[n.totalProperty]),this.data.clear(),this.appendData(e),this.fireEvent("datachanged",this)}else this.data.clear(),this.fireEvent("datachanged",this);this.fireEvent("load",this)},handleLoadFailed:function(){this.data.clear(),this.fireEvent("loadfailed",this)},handleRequestComplete:function(){this.loading=!1,this.lastXmlRequest=null,this.showPageLoading&&this.hidePageLoadingMsg(),this.fireEvent("loadcomplete",this)},appendData:function(e){t.each(e,function(e,t){this.data.add(this.createModel(t))},this)},createModel:function(e){return t.create("model",{useWebDatabase:!1,idProperty:this.idProperty,fields:this.fields,values:e,listeners:{scope:this,datachanged:function(e){this.fireEvent("datachanged",this,e)},destroy:function(e){this.data.remove(e),this.fireEvent("datachanged",this,e)}}})},first:function(){this.load({page:1})},last:function(){if(t.isDefined(this.total)){var e=this.getPageData().pageCount;this.load({page:e})}},prev:function(){this.load({page:this.currentPage-1})},next:function(){this.currentPage==1&&this.get().length==0?this.first():this.load({page:this.currentPage+1})},add:function(e){this.appendData(t.toArray(e))},insert:function(e,t){this.data.insert(e,this.createModel(t)),this.fireEvent("datachanged",this)},remove:function(e){var t=this.data.item(e);t&&t.destroy()},each:function(e,t){this.data.each(e,t||this)},get:function(e,n){var r,i;return t.isBoolean(e)&&(n=e,e=null),e?(i=this.data.item(e),i&&(r=i.get(n))):(r=[],this.each(function(e){r.push(e.get(n))})),r},getPageData:function(){return{total:this.total,maxPage:this.maxPage,currentPage:this.currentPage,pageCount:t.isDefined(this.total)?Math.ceil(this.total/this.pageSize):1,fromRecord:(this.currentPage-1)*this.pageSize+1,toRecord:t.isDefined(this.total)?Math.min(this.currentPage*this.pageSize,this.total):this.pageSize}},sync:function(){},getStorageKey:function(e,t,n){return e+"-"+t},loadStorage:function(e){var t=this,r=e.page,i;t.useWebDatabase?(i=t.getStorageKey(t.storageKey,r,t.params),t.db.transaction(function(r){r.executeSql("SELECT * FROM "+t.tableName+" WHERE id = ?",[i],function(r,i){if(i.rows.length>0){var s=i.rows.item(0);if(s._last_updated+t.cacheExpires<n.now())t.fetch(e);else{try{t.handleLoadSuccess(JSON.parse(s.value))}catch(o){t.handleLoadFailed()}t.handleRequestComplete()}}else t.fetch(e)})},function(e){t.handleLoadFailed(),t.handleRequestComplete()})):t.fetch(e)},updateStorage:function(){var e=this,t;e.useWebDatabase&&(t=e.getStorageKey(e.storageKey,e.currentPage,e.params),e.db.transaction(function(r){r.executeSql("SELECT * FROM "+e.tableName+" WHERE id = ?",[t],function(r,i){try{var s=[],o=JSON.stringify(e.get(null,!0)),u;i.rows.length>0?(u="UPDATE "+e.tableName+" SET value = ?, _last_updated = ? WHERE id = ?",s.push(o),s.push(n.now()),s.push(t)):(u="INSERT INTO "+e.tableName+" (id, value, _last_updated) VALUES (?, ?, ?)",s.push(t),s.push(o),s.push(n.now())),r.executeSql(u,s)}catch(a){}})},function(e){}))},showPageLoadingMsg:function(){n.mobile.showPageLoadingMsg()},hidePageLoadingMsg:function(){n.mobile.hidePageLoadingMsg()},onDestroy:function(){this.db=null}})}),MX.kindle("jquery","klass",function(e,t,n){e.app.View=n.define({alias:"view",extend:"utility",init:function(){this.initTemplate()},initTemplate:function(){var n=this.templates;this.templates=[],n&&(e.isArray(n)||(n=[n]),e.each(n,function(e,n){this.addTemplate(t.extend({},n))},this)),this.headerCfg&&this.headerCfg.template&&(this.headerTmpl=this.addTemplate(e.isString(this.headerCfg.template)?{id:this.headerCfg.template}:t.extend({},this.headerCfg.template))),this.footerCfg&&this.footerCfg.template&&(this.footerTmpl=this.addTemplate(e.isString(this.footerCfg.template)?{id:this.footerCfg.template}:t.extend({},this.footerCfg.template))),this.bodyCfg&&this.bodyCfg.template&&(this.bodyTmpl=this.addTemplate(e.isString(this.bodyCfg.template)?{id:this.bodyCfg.template}:t.extend({},this.bodyCfg.template)))},initEvents:function(){this.addEvents("beforerender","render")},render:function(e){if(!this.rendered&&this.fireEvent("beforerender",this)!==!1){this.rendered=!0,this.container=e=t(e),this.headerCfg&&(this.header=t(document.createElement("div")),this.header.attr("id","mx-app-page-header-"+this.id).attr("data-"+t.mobile.ns+"role","header"),this.headerCfg.fixed&&this.header.attr("data-"+t.mobile.ns+"position","fixed"),this.headerCfg.cls&&this.header.addClass(this.headerCfg.cls),this.headerTmpl&&(this.headerTmpl.container=this.header,!this.headerTmpl.store&&this.headerTmpl.render()),e.append(this.header));var n=this.bodyCfg||{};this.body=t(document.createElement("div")),this.body.attr("id","mx-app-page-body-"+this.id).attr("data-"+t.mobile.ns+"role","content"),n.fixed&&this.body.attr("data-"+t.mobile.ns+"position","fixed"),n.cls&&this.body.addClass(n.cls),this.bodyTmpl&&(this.bodyTmpl.container=this.body,!this.bodyTmpl.store&&this.bodyTmpl.render()),e.append(this.body),this.footerCfg&&(this.footer=t(document.createElement("div")),this.footer.attr("id","mx-app-page-footer-"+this.id).attr("data-"+t.mobile.ns+"role","footer"),this.footerCfg.fixed&&this.footer.attr("data-"+t.mobile.ns+"position","fixed"),this.footerCfg.cls&&this.footer.addClass(this.footerCfg.cls),this.footerTmpl&&(this.footerTmpl.container=this.footer,!this.footerTmpl.store&&this.footerTmpl.render()),e.append(this.footer)),this.onRender(e),this.fireEvent("render",this,e)}},onRender:e.emptyFn,addTemplate:function(t){t=t||{},t.params=this.params;var n=e.create("template",t);return this.templates[n.id]=n,n},getTemplate:function(e){return this.templates[e]},onDestroy:function(){this.header&&(this.header.remove(),this.header=null),this.footer&&(this.footer.remove(),this.footer=null),this.body&&(this.body.remove(),this.body=null),this.container=null,e.each(this.templates,function(e,t){t.destroy()}),this.templates=null}})}),MX.kindle("klass",function(e,t){e.app.Controller=t.define({alias:"controller",extend:"utility",init:function(){this.relayMethod(this.view,"getTemplate")},initEvents:function(){this.addEvents("pagecreate","pagebeforeshow","pageshow","pagebeforehide","pagehide","orientationchange")},delegateEvent:function(t,n,r,i,s){if(e.isObject(n)){var o,u,a,r,f;s=n.scope||this,delete n.scope;for(o in n)a=o.indexOf(" "),r=o.substring(a+1),u=o.substring(0,a),f=n[o],f=e.isString(f)?this[f]:f,this.delegateEvent(t,u,r,f,s);return}this.mon(t,n,r,i,s)},onViewRender:function(){this.delegates&&(this.delegateEvent(this.view.container,this.delegates),delete this.delegates),this.onPageCreate(),this.fireEvent("pagecreate",this)},onPageCreate:e.emptyFn,beforePageShow:e.emptyFn,onPageShow:e.emptyFn,beforePageHide:e.emptyFn,onPageHide:e.emptyFn,onOrientationChange:e.emptyFn,getModel:function(e){return this.models[e]},getStore:function(e){return this.stores[e]},getHeader:function(){return this.view.header},getFooter:function(){return this.view.footer},getBody:function(){return this.view.body},getContainer:function(){return this.view.container},getCt:function(){return this.getContainer()},getParams:function(){return this.params},onDestroy:function(){this.view=null,this.models=this.stores=null}})}),MX.kindle("jquery","klass",function(e,t,n){var r=/(:|\*)\w+/g;e.app.Pagelet=n.define({alias:"pagelet",extend:"utility",singleton:!1,noCache:!1,init:function(){this.urlParamNames=this.url.match(r),this.parseParams(),this.initTransition(),this.initView(),this.initModels(),this.initStores(),this.initController()},parseParams:function(){var t=this.urlRe.exec(this.hash).slice(1),n={};return e.each(this.urlParamNames,function(e,r){n[r.substr(1)]=t[e]},this),this.params=n,n},initTransition:function(){this.transition=this.transition||"",e.isString(this.transition)&&(this.transition={show:this.transition,hide:""}),e.isString(this.transition.show)&&(this.transition.show={effect:this.transition.show}),e.isString(this.transition.hide)&&(this.transition.hide={effect:this.transition.hide})},initModels:function(){this.models=this.models||{},e.each(this.models,function(e,t){t.params=this.params,t.bindTo==="header"&&this.view.headerTmpl?this.view.headerTmpl.bindStore(t):t.bindTo==="footer"&&this.view.footerTmpl?this.view.footerTmpl.bindStore(t):t.bindTo==="body"&&this.view.bodyTmpl&&this.view.bodyTmpl.bindStore(t)},this)},initStores:function(){this.stores=this.stores||{},e.each(this.stores,function(e,t){t.params=this.params,t.bindTo==="header"&&this.view.headerTmpl?this.view.headerTmpl.bindStore(t):t.bindTo==="footer"&&this.view.footerTmpl?this.view.footerTmpl.bindStore(t):t.bindTo==="body"&&this.view.bodyTmpl&&this.view.bodyTmpl.bindStore(t)},this)},initEvents:function(){this.addEvents("beforerender","render")},initView:function(){this.view=e.create(this.view||"view",{params:this.params}),this.mon(this.view,"render",this.onViewRender)},initController:function(){this.controller=e.create(this.controller||"controller",{view:this.view,models:this.models,stores:this.stores,params:this.params})},render:function(e){!this.rendered&&this.fireEvent("beforerender",this)!==!1&&(this.rendered=!0,this.container=e=t(e),this.el=t(document.createElement("div")),this.el.attr("id","mx-app-page-"+this.id).attr("data-"+t.mobile.ns+"role","page").attr("data-"+t.mobile.ns+"url","#/"+this.hash),this.cls&&this.el.addClass(this.cls),e.append(this.el),this.view&&this.view.render(this.el),this.mon(this.el,{pagebeforeshow:this.beforePageShow,pageshow:this.onPageShow,pagebeforehide:this.beforePageHide,pagehide:this.onPageHide}),this.onRender(e),this.fireEvent("render",this,e))},onRender:e.emptyFn,onViewRender:function(){this.controller&&this.controller.onViewRender()},beforePageShow:function(){this.controller&&(this.controller.beforePageShow(),this.controller.fireEvent("pagebeforeshow",this.controller))},onPageShow:function(){this.loadModelOrStore(this.models),this.loadModelOrStore(this.stores),this.controller&&(this.controller.onPageShow(),this.controller.fireEvent("pageshow",this.controller))},beforePageHide:function(){this.cancelFetch(),this.controller&&(this.controller.beforePageHide(),this.controller.fireEvent("pagebeforehide",this.controller))},onPageHide:function(){this.controller&&(this.controller.onPageHide(),this.controller.fireEvent("pagehide",this.controller))},onOrientationChange:function(){this.controller&&(this.controller.onOrientationChange(),this.controller.fireEvent("orientationchange",this.controller))},cancelFetch:function(){e.each(this.models,function(e,t){t.cancelFetch()},this),e.each(this.stores,function(e,t){t.cancelFetch()},this)},loadModelOrStore:function(t){e.each(t,function(e,t){t.autoLoad===!0&&t.load()},this)},getView:function(){return this.view},getController:function(){return this.controller},onDestroy:function(){this.models&&e.isObject(this.models)&&e.each(this.models,function(e,t){t.destroy()}),this.stores&&e.isObject(this.stores)&&e.each(this.stores,function(e,t){t.destroy()}),this.controller&&(this.controller.destroy(),this.controller=null),this.view&&(this.view.destroy(),this.view=null),this.el&&(this.el.remove(),this.el=null),this.container=null}})}),MX.kindle("jquery","klass","localstorage","pagelet",function(t,n,r,i,s){var o=n(e),u=n("body"),a=e.location,f=/#(.*)$/,l=/^[#\/]/,c=/:\w+/g,h=/\*\w+/g,p=/[-[\]{}()+?.,\\^$|#\s]/g;t.app.Application=r.define({alias:"application",extend:"utility",templateVersion:"1.0",useWebDatabase:!0,databaseSize:52428800,databaseVersion:"1.0",databaseExpires:2592e5,pageletCacheSize:30,startUpSelector:"div#startUpView",init:function(){this.models={},this.stores={},this.pagelets={},this.pageletCaches=this.pageletCaches||[],this.history=new n.mobile.History},initEvents:function(){this.addEvents("beforelaunch","launch","pagebeforechange","pagechange","pageafterchange","pagechangefailed"),this.mon(e,"hashchange",this.onHashChange),this.mon(e,"orientationchange",this.onOrientationChange)},launch:function(e){e=e||{},this.setConfig(e);var r=i.get("mx-app/templates"),s=i.get("mx-app/template-version"),o=n.now();(s!=this.templateVersion||!r)&&this.templateUrl?n.ajax({url:this.templateUrl,type:"GET",dataType:"text",context:this}).done(function(r){i.set("mx-app/template-version",this.templateVersion),i.set("mx-app/templates",r),this.createTemplateElement(r),o=n.now()-o,o>200?this._launch(e):t.defer(this._launch,o,this,[e])}).fail(function(){}):(this.createTemplateElement(r),t.defer(this._launch,200,this,[e]))},_launch:function(t){if(!this.isLaunched&&this.beforeLaunch()!==!1&&this.fireEvent("beforelaunch",this)!==!1){this.isLaunched=!0,this.cls&&this.pageContainer.addClass(this.cls),this.startUpView=n(this.startUpSelector),this.startUpView.length==0?this.startUpView=null:(this.startUpView.page(),this.startUpView.css("min-height",e.innerHeight+"px")),n.extend(n.mobile,{firstPage:this.startUpView||n(""),activePage:this.startUpView,pageContainer:this.pageContainer}),o.trigger("pagecontainercreate"),this.mon(this.pageContainer,{pagechange:this.onPageChange,pagechangefailed:this.onPageChangeFailed}),this.initDatabase(),this.addModel(t.models),this.addStore(t.stores),this.addPagelet(t.pagelets),this.onLaunch(),this.fireEvent("launch",this);var r=this.getHash(),i=this.matchPagelet(r);i?(i=this.createPagelet(i,r),this.changePage(i)):this.go(this.welcome)}},beforeLaunch:t.emptyFn,onLaunch:t.emptyFn,createTemplateElement:function(e){this.templateCt=n(document.createElement("div")),this.templateCt.attr("id","mx-app-templates").hide(),this.templateCt.html(e),u.append(this.templateCt)},setConfig:function(e){e=n.extend({},e),delete e.models,delete e.stores,delete e.pagelets,n.extend(this,e),this.pageContainer=u,this.useWebDatabase&&(this.useWebDatabase=!!this.databaseName),this.welcome=this.welcome||""},initDatabase:function(){var n=this,r=!1;if(n.useWebDatabase){if(e.openDatabase)try{n.db=e.openDatabase(n.databaseName,n.databaseVersion,n.databaseDescription,n.databaseSize,function(e){})}catch(s){r=!0}else r=!0;n.db?n.db.transaction(function(e){e.executeSql("CREATE TABLE IF NOT EXISTS systables (table_name)",[],function(e,r){var s=i.get("mx-app/database-last-cleaned"),o=!1,u=new Date,a,f;s&&(a=new Date,a.setTime(s),o=u.getFullYear()==a.getFullYear()&&u.getMonth()==a.getMonth()&&u.getDate()==a.getDate()),t.isDefined(n.databaseExpires)&&n.databaseExpires>0&&!o&&(u=u.getTime(),f=u-n.databaseExpires,e.executeSql("SELECT table_name FROM systables",[],function(e,t){var n=t.rows,r,i,s;for(r=0,i=n.length;r<i;r++)s=n.item(r).table_name,e.executeSql("DELETE FROM "+s+" WHERE _last_updated < ?",[f])}),i.set("mx-app/database-last-cleaned",u))}),e.executeSql("CREATE TABLE IF NOT EXISTS syscolumns (table_name, column_name)",[])},function(e){r=!0}):r=!0,n.useWebDatabase=!r}},addModel:function(e){if(e){if(t.isArray(e)){t.each(e,function(e,t){this.addModel(t)},this);return}var r=n.extend({},e);r.useWebDatabase=this.useWebDatabase?r.useWebDatabase:!1,r.db=this.db,this.models[e.id]=r}},addStore:function(e){if(e){if(t.isArray(e)){t.each(e,function(e,t){this.addStore(t)},this);return}var r=n.extend({},e);r.useWebDatabase=this.useWebDatabase?r.useWebDatabase:!1,r.db=this.db,this.stores[e.id]=r}},addPagelet:function(e){if(e){if(t.isArray(e)){t.each(e,function(e,t){this.addPagelet(t)},this);return}var r=n.extend({},e);r.urlRe=new RegExp("^"+r.url.replace(p,"\\$&").replace(c,"([^/]+)").replace(h,"(.*?)")+"$"),this.pagelets[r.id]=r}},getHash:function(){var e=a.href.match(f);return e?e[1].replace(l,""):""},matchPagelet:function(e){var n;return t.each(this.pagelets,function(t,r){if(r.urlRe&&r.urlRe.test(e))return n=r,!1}),n},createPagelet:function(e,t){var r,i,o,u;e.hash=t;if(e.singleton)e.instance||(e.instance=new s(this.preparePageletConfig(n.extend({},e)))),r=e.instance;else if(e.noCache)r=new s(this.preparePageletConfig(n.extend({},e,{id:null})));else{for(u=this.pageletCaches.length,o=u-1;o>=0;o--){i=this.pageletCaches[o];if(i.isDestroyed||i.destroying){this.pageletCaches.splice(o,1),o--;continue}if(i.hash==t){this.pageletCaches.splice(o,1),r=i;break}}r||(r=new s(this.preparePageletConfig(n.extend({},e,{id:null})))),this.pageletCaches.push(r),u=this.pageletCaches.length;if(u>this.pageletCacheSize&&u>3)for(o=0;o<u;o++){i=this.pageletCaches[o];if(r!=i){this.pageletCaches.splice(o,1),i.destroy();break}}}return r},preparePageletConfig:function(e){var r,i,s,o,u;return e.models&&(r=e.models,e.models={},t.each(t.toArray(r),function(r,s){t.isString(u)&&(s={id:s}),u=s.id,i=this.models[u],s=n.extend({},s,i),e.models[u]=t.create(i.cls||"model",s)},this)),e.stores&&(s=e.stores,e.stores={},t.each(t.toArray(s),function(r,i){t.isString(i)&&(i={id:i}),u=i.id,o=this.stores[u],i=n.extend({},i,o),e.stores[u]=t.create(o.cls||"store",i)},this)),e},getPagelet:function(e){var t,n,r;for(r=this.pageletCaches.length,n=r-1;n>=0;n--){t=this.pageletCaches[n];if(t.isDestroyed||t.destroying){this.pageletCaches.splice(n,1),n--;continue}if(t.hash==e)return t}return null},existPagelet:function(e){return!!this.getPagelet(e)},destroyPagelet:function(e){e&&!e.singleton&&e.noCache===!0&&e.destroy()},go:function(e,t){this.isPageChanging||(this.lastHash=e,this.pageChangeOptions=n.extend({},t),a.hash="#/"+e)},back:function(){var e=this.history.getPrev(),t=this.welcome;this.history.direct({url:e?e.url:"",back:function(){a.hash=e.hash},missing:function(){a.hash="#/"+t}})},onHashChange:function(){var e=this.getHash(),t;this.lastHash&&this.lastHash!=e&&(this.pageChangeOptions=null),!this.isPageChanging&&(t=this.matchPagelet(e))?(t=this.createPagelet(t,e),this.changePage(t)):this.pageChangeOptions=null},changePage:function(t){var r=n.mobile.path,i,s=this.lastPagelet,o,a,f;e.scrollTo(0,1),i=r.getLocation(),this.history.add(i,{url:i,hash:t.hash}),!this.isPageChanging&&this.fireEvent("beforepagechange",this,t,s)!==!1&&(this.isPageChanging=!0,this.pageChangeOptions=this.pageChangeOptions||{},o=this.nextPagelet=t,o.render(this.pageContainer),o.el.css("min-height",e.innerHeight+"px"),f=n.extend({},this.pageChangeOptions,{fromHashChange:!0}),this.startUpView&&(a="fade"),!a&&o.controller.getTransition&&(a=o.controller.getTransition(o.hash,s?s.hash:"")),!a&&s&&(a=s.transition.hide.effect,f.reverse=s.transition.hide.reverse),a||(a=o.transition.show.effect||o.transition.hide.effect||"fade",f.reverse=o.transition.show.reverse),f.transition=a,u.scrollTop(0),n.mobile.changePage(o.el,f))},onPageChange:function(){u.scrollTop(0),this.fireEvent("pagechange",this,this.nextPagelet,this.lastPagelet),this.afterChangePage()},onPageChangeFailed:function(){this.fireEvent("pagechangefailed",this,this.nextPagelet,this.lastPagelet)},afterChangePage:function(){this.startUpView&&(this.startUpView.remove(),this.startUpView=null),this.destroyPagelet(this.lastPagelet),this.lastPagelet=this.nextPagelet,this.nextPagelet=null,this.isPageChanging=!1,this.pageChangeOptions=null,this.lastHash=null,this.fireEvent("pageafterchange",this,this.lastPagelet)},onOrientationChange:function(t){var n=this.lastPagelet;n&&(n.el.css("min-height",e.innerHeight+"px"),n.onOrientationChange())},onDestroy:function(){t.each(this.pageletCaches,function(e,t){t.destroy()},this),this.pageletCaches=null,this.pageContainer=null}}),t.App=new t.app.Application,n("html").addClass("ui-mobile"),e.scrollTo(0,1),n.extend(n.mobile,{autoInitializePage:!1,pushStateEnabled:!1,hashListeningEnabled:!1,defaultHomeScroll:0})})})